IBoxLoader: !include
  - cloudfront/for-services.yml
  - lambda/permission.yml
  - iam/role.yml

global:
  Output:
    - InvokeUrl:
        Value: Sub('https://${ApiGatewayRestApi}.execute-api.${AWS::Region}.amazonaws.com/%s' % cfg.ApiGatewayRestApi['Base']['Stage'])
  ApiGatewayRestApi:
    - Base:
        ApiKeySourceType: HEADER
        BinaryMediaTypes:
          - '*/*'
        Description: 'Api-Gateway Description is missing'
        EndpointConfiguration:
          Types:
            - REGIONAL
        Name: 'Api-Gateway Name is missing'
        Policy:
          Statement:
            - IBOX_LIST:
            - 1:
                Action: "execute-api:Invoke"
                Effect: Allow
                Principal: '*'
                Resource: "execute-api:/*"
          Version: "2012-10-17"
  CloudFront: 'yes'
  CloudFrontAliasExtra:
    - Cdn: Sub('${EnvRole}${RecordSetCloudFrontSuffix}.cdn.%s' % cfg.HostedZoneNameEnv)
  CloudFrontOrigins:
    - Default:
        CustomOriginConfig:
          HTTPSPort: '443'
          HTTPPort: Ref('AWS::NoValue')
        DomainName:  Sub('${ApiGatewayRestApi}.execute-api.${AWS::Region}.amazonaws.com')
