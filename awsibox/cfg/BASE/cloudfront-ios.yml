IBoxLoader: !include [
  cloudfront.yml,
]

global:
  Parameter:
    - CloudFront:
        Description: 'Create CloudFront Distribution - empty for default based on env/role'
        AllowedValues: ['', 'None', 'True']
    - RecordSetCloudFrontSuffix:
        Description: 'RecordSetCloudFront DNS Name Suffix - empty to disable'
  Condition:
    - CloudFrontAliasZone:
        get_condition('', 'not_equals', 'None', 'CloudFrontAliasZone')
    - CloudFrontDistribution:
        get_condition('', 'not_equals', 'None', 'CloudFront')
    - CloudFrontOriginProtocolHTTP:
        And(
          Condition('ListenerLoadBalancerHttpPort'),
          get_condition('', 'not_equals', 'https-only', 'CloudFrontOriginProtocolPolicy')
        )
    - CloudFrontOriginProtocolHTTPS:
        And(
          Condition('ListenerLoadBalancerHttpsPort'),
          get_condition('', 'not_equals', 'http-only', 'CloudFrontOriginProtocolPolicy')
        )
    - RecordSetCloudFront:
        And(
          Condition('CloudFrontDistribution'),
          get_condition('', 'not_equals', 'None', 'RecordSetCloudFront')
        )
  Output:
    - CloudFront:
        Value: get_endvalue('CloudFront')
    - RecordSetCloudFront:
        Condition: RecordSetCloudFront
        Value: Sub('${RecordSetCloudFront} --> ${CloudFrontDistribution.DomainName}')
  CloudFrontCacheBehaviors:
    - 0:
        TargetOriginId: Sub('${EnvRole}${RecordSetCloudFrontSuffix}.origin.%s' % cfg.HostedZoneNameEnv)
  CloudFrontAliasExtra:
    - 1: None
    - 2: None
  CloudFrontAliasZone: None
  CloudFrontOriginPath: ''
  CloudFrontOriginProtocolPolicy: https-only
  CloudFrontOriginKeepaliveTimeout: 5
  CloudFrontOriginReadTimeout: 30
  RecordSetCloudFront: None


IBoxLoaderAfter: !include [
  cloudfront-adhoc.yml,
]
