IBoxLoader:
  - !exclude
    - iam/ecs-exec.yml
  - !include
    - ecs/ecs-task.yml
    - ecs/ecs-service.yml

global:
  Parameter:
    - DaemonReserveCpu:
        Description: 'Empty for mapped value'
        AllowedValues: ['', 'True', 'False']
  Condition:
    - DaemonReserveCpu:
        get_condition('', 'equals', 'True', 'DaemonReserveCpu')
  Output:
    - DaemonReserveCpu:
        Value: get_endvalue('DaemonReserveCpu')
  DaemonReserveCpu: 'False'
  ContainerDefinitions:
    - ReserveCpu:
        Command: ['tail', '-f']
        Cpu: 512
        Image: 'busybox'
        LogConfiguration: IBOXSKIPFUNC
        Memory: 32
        MemoryReservation: 32
  # Included yaml ecs/ecs-task.yml have changed ParameterStore Roles to RoleTask, need to restore it.
  IAMPolicy:
    - ParameterStore:
        Roles:
          - Ref('RoleInstance')
  LaunchType: EC2
  Log:
    Driver: None
    GroupName: IBOXSKIPFUNC
  Role:
    - Task:
        Condition: DaemonReserveCpu
  Service:
    - Base:
        IBOXENABLED: False
    - Daemon:
        IBOXENABLED: True
        Condition: DaemonReserveCpu
        Cluster: Ref('Cluster')
        NetworkConfiguration: IBOXSKIPFUNC
  TaskDefinition:
    - Base:
        Condition: DaemonReserveCpu
