global:
  ECSTaskDefinition:
    - Base:
        IBOX_TITLE: TaskDefinition
        Cpu.IBOX_CODE: If(IBOX_CURNAME, get_endvalue(IBOX_CURNAME), Ref('AWS::NoValue'))
        Cpu.IBOX_AUTO_PO:
          Condition: IBOX_CURNAME
          AllowedValues: [
            '', 'none', '128', '256', '384', '512', '640', '768', '896', '1024',
            '1152', '1280', '1408', '1536', '1664', '1792', '1920', '2048',
            '2176', '2304', '2432', '2560', '2688', '2816', '2944', '3072',
            '3200', '3328', '3456', '3584', '3712', '3840', '3968', '4096',
          ]
          CONDITION: get_condition('', 'not_equals', 'none', IBOX_CURNAME)
        Cpu: none
        ExecutionRoleArn: If('ECSTasksLaunchOnFargate', get_expvalue('RoleECSTaskExecution'), Ref('AWS::NoValue'))
        Memory.IBOX_CODE: If(IBOX_CURNAME, get_endvalue(IBOX_CURNAME), Ref('AWS::NoValue'))
        Memory.IBOX_AUTO_PO:
          Condition: IBOX_CURNAME
          CONDITION: get_condition('', 'not_equals', 'none', IBOX_CURNAME)
        Memory: none
        NetworkMode.IBOX_CODE: If("ECSTasksLaunchOnFargate", "awsvpc", get_endvalue(IBOX_CURNAME))
        NetworkMode.IBOX_AUTO_PO:
          AllowedValues: ['', 'awsvpc', 'bridge']
        NetworkMode.IBOX_PCO:
          IBOX_CONDITION:
            - _NetworkModeAwsVpc:
                get_condition('', 'equals', 'awsvpc', IBOX_CURNAME, OrExtend=[Condition('ECSTasksLaunchOnFargate')])
            - _NetworkModeStandard:
                get_condition('', 'not_equals', 'awsvpc', IBOX_CURNAME)
        NetworkMode: bridge
        RequiresCompatibilities: If('ECSTasksLaunchOnFargate', ['EC2', 'FARGATE'], ['EC2'])
        TaskRoleArn: Ref('RoleTask')
    - Fargate:
        IBOX_TITLE: TaskDefinitionFargate
        IBOX_ENABLED: False
        Cpu: '256'
        ExecutionRoleArn: get_expvalue('RoleECSTaskExecution')
        Memory: '512'
        NetworkMode: awsvpc
        RequiresCompatibilities: ['FARGATE']
        TaskRoleArn: Ref('RoleTask')
