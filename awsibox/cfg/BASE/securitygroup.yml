Rule:
  - Http: &rulehttp
      IpProtocol: tcp
      CidrIp: '0.0.0.0/0'
      FromPort: 80
      ToPort: 80
  - Https: &rulehttps
      IpProtocol: tcp
      CidrIp: '0.0.0.0/0'
      FromPort: 443
      ToPort: 443

ALBExternal: &albexternal
  IBOXOUTPUT:
    - IBOXRESNAME:
        Condition: LoadBalancerApplicationExternal
        Value:  GetAtt(f'{IBOXRESNAME}', 'GroupId')
        Export: Export(Sub('%s-${AWS::StackName}' % IBOXRESNAME))
  Condition: 'LoadBalancerApplicationExternal'
  GroupDescription: Sub('Access to LoadBalancerApplicationExternal ${AWS::StackName}')
  SecurityGroupIngress:
    - Http: *rulehttp
    - Https: *rulehttps 

ALBInternal: &albinternal
  IBOXOUTPUT:
    - IBOXRESNAME:
        Condition: LoadBalancerApplicationInternal
        Value:  GetAtt(f'{IBOXRESNAME}', 'GroupId')
        Export: Export(Sub('%s-${AWS::StackName}' % IBOXRESNAME))
  Condition: 'LoadBalancerApplicationInternal'
  GroupDescription: Sub('Access to LoadBalancerApplicationInternal ${AWS::StackName}')
  SecurityGroupIngress:
    - Http: *rulehttp

AllowedIpBase: &allowedipbase
  IBOXCONDITION:
    - IBOXMAPNAME:
        get_condition('', 'not_equals', 'None', f'{IBOXMAPNAME}Enabled')
  Enabled: True
  Description: ''
  CidrIp: '127.0.0.1/32'


global:
  SecurityGroupALB:
    - External: *albexternal
    - Internal: *albinternal
  AllowedIp:
    - IBOXBASE: *allowedipbase
  SecurityGroups: 'BaseInstance,None,None,None'
